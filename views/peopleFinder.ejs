<div class="col-lg-9">
                <% include ./partials/messages %>
<h2> People Finder</h2>

<form method="POST" action="/users/peopleFinder" autocomplete="off" id="org_form">
<div class="form-group">        
        <div class="row" hidden>
                <div class="col-lg-3">
                        <p>Catagory :</p>
                </div>
                <div class="col-lg-4">
                        <input type="text" class="form-control" placeholder="Role Name" id="role_name" name="role_name">
                </div>
        </div>      
        <div class="row">
        <div class="col-lg-3">
                        <p>Country :</p>
                </div>  
        <div class="col-lg-4">
                <select class="custom-select" id="country" name="country">
                        <option value="All" <%=location_name == "All" ? 'selected':''%>>All</option>
                <%locations.forEach(function(location){%>
                        <option value="<%=location.location_name%>" <%=location_name== location.location_name ? 'selected':''%>><%=location.location_name%></option>        
                <%});%>                                      
                </select>
        </div>
</div> 
        
        <div class="row">                
                <div class="col-lg-3">
                                <p>Skill Set:</p>
                        </div>  
                <div class="col-lg-4">
                        <select class="custom-select" id="skill_name" name="skill_name"  onchange="getSG();">  
                                <option value=""></option>
                        <%skills.forEach(function(skill){%>
                                <option value="<%=skill.skill_name%>" <%=skill_name == skill.skill_name ? 'selected':''%>><%=skill.skill_name%></option>        
                        <%});%>                                      
                        </select>
                </div>
        </div>

        <div class="row">                
                <div class="col-lg-3">
                                <p>Skill Group :</p>
                        </div>  
                <div class="col-lg-4">
                        <select class="custom-select" id="skill_group_name" name="skill_group_name" onchange="getSK()">  
                                                           
                        </select>
                </div>
        </div>
        <div class="row">                
                <div class="col-lg-3">
                        <p>Skills :</p>
                </div>  
                <div class="col-lg-4">
                        <select class="custom-select" id="skill" name="skill">                                                          
                                </select>
                        
                </div>
                </div>                
         </div>      
         
        <div>
                <div class="row">
                <div class="col-lg-3">
                </div>
                <div class="col-lg-4">
                                <button type="submit" class="btn btn-primary">Find</button>
                </div>
                </div>
        </div>
        <input type="hidden" class="form-control"  id="email" name="email" value="<%=user.email%>">

</form>
<br><br><br>
<div class="table-responsive">   
                <table class="table table-hover table-striped table-hover table-bordered display dt-responsive" cellspacing="0"   name="dataTables-qualifications" style="white-space: nowrap;" id='test'>                                                                                                       
                <thead>
                <tr>
                        <th>Name</th>
                        <th>Country</th>                                            
                        <th>Skill</th>                                            
                        <th>Skill Group</th>
                        <th>Skill</th>
                        <th>Proficiency</th>                                            
                </tr>
                </thead>
                <tbody>                        
                
                <% recs.forEach(function(rec){%>
                <%if(user.email != rec.email){%>
                <tr>                
                <td><a href="/users/skillsbyPerson/<%=rec._id%>"><%=rec.firstName%> <%=rec.lastName%></a></td>                
                <td><%=rec.country%></td>
                <td><%=rec.skill_name%></td> 
                <%var sg_row=0%>                
                
                <%rec.skillset[0].skill_group.forEach(function(sg){%>
                        <%if(!skill_group_name){%>
                                <%if(sg_row!=0){%>
                                        <td></td><td></td><td></td>
                                        <%}%>
                                <td ><%=sg.skill_group_name%></td>              
                                  <%var sk_row=0;%>
                                  <%if(sg.skills.length==0){%>
                                  <td></td>
                                  
                                  </tr>
                                  <%}else{%>
                                  
                                    <%}%>
                                  <%sg.skills.forEach(function(skill1){%>
                                    <%if(sk_row!=0){%>
                                      <tr>                                
                                                <td></td><td></td><td></td>
                                        <td></td>                      
                                    <%}%>
                                    <td><%=skill1.skill%></td>
                                    <td><%=skill1.proficiency%></td>
                                    <%sk_row++;%>
                                  </tr>
                                    <%});%>
                                </tr>
                              <%sg_row++;%>
                        <%}else{%>
                                <%if(sg.skill_group_name==skill_group_name){%>
                                <%if(sg_row!=0){%>
                                        <td></td><td></td><td></td>
                                        <%}%>
                                <td ><%=sg.skill_group_name%></td>              
                                  <%var sk_row=0;%>
                                  <%if(sg.skills.length==0){%>
                                  <td></td>
                                  
                                  </tr>
                                  <%}%>                                  
                                   
                                  <%sg.skills.forEach(function(skill1){%>
                                    <%if(!skill){%>
                                        <%if(sk_row!=0){%>
                                                <tr>                                
                                                          <td></td><td></td><td></td>
                                                  <td></td>                      
                                              <%}%>
                                              <td><%=skill1.skill%></td>
                                              <td><%=skill1.proficiency%></td>
                                              <%sk_row++;%>
                                            </tr>
                                
                                        <%}else{%>                                                
                                            <%if(skill1.skill==skill){%>
                                                <%if(sk_row!=0){%>
                                                        <tr>                                
                                                                  <td></td><td></td><td></td>
                                                          <td></td>                      
                                                      <%}%>
                                                      <td><%=skill1.skill%></td>
                                                      <td><%=skill1.proficiency%></td>
                                                      <%sk_row++;%>
                                                    </tr>
                                        <%}%>
                                        <%}%>
                                    <%});%>
                                </tr>
                              <%sg_row++;%>

                              <%}%>


                        <%}%>
                <%});%>                          


                </tr>     
                <%}%>                                                                                             
                <%});%>
                </tbody>                                                                                          
                </table>                                               
        </div>

</div>


<div class="col-lg-9">        
          
</div>




<script>
window.onload = getSG();
function getSG(){
        var s1 = document.getElementById('skill_group_name');
        s1.innerHTML = "";
        $.ajax({
                
                type: 'POST',						
                contentType: 'application/json',
                url: '/skills/getSkillGroup/'+document.getElementById('skill_name').value,						
                success: function(res,custid) {
                var s1 = document.getElementById('skill_group_name');
                            s1.innerHTML = "";
                           var newOption = document.createElement("option"); 
                           newOption.value = "";
                           newOption.innerHTML = "";
                           s1.options.add(newOption);                          
                           console.log(res);
                           res.sg.skill_group.forEach(function(sg){
                            var newOption = document.createElement("option"); 
                            newOption.value = sg.skill_group_name;
                            newOption.id = "x"+sg.skill_group_name;
                           newOption.innerHTML = sg.skill_group_name;
                           s1.options.add(newOption);
                           }); 
                           
                           document.getElementById("x"+"<%=skill_group_name%>").selected = true;
                           getSK();
                        }
                        });
};


function getSK(){
        var s1 = document.getElementById('skill');
        s1.innerHTML = "";
        $.ajax({
                
                type: 'POST',						
                contentType: 'application/json',
                url: '/skills/getSkillGroupSkill/'+document.getElementById('skill_name').value+'/'+document.getElementById('skill_group_name').value,						
                success: function(res,custid) {
                var s1 = document.getElementById('skill');
                            s1.innerHTML = "";
                           var newOption = document.createElement("option"); 
                           newOption.value = "";
                           newOption.innerHTML = "";
                           s1.options.add(newOption);                          
                           console.log(res);
                           res.sg.skill_group.forEach(function(sg){
                           if(sg.skill_group_name == document.getElementById('skill_group_name').value){
                                   sg.skills.forEach(function(sk){
                                        var newOption = document.createElement("option"); 
                                        newOption.value = sk.skill;
                                        newOption.id = "y"+sk.skill;
                                        newOption.innerHTML = sk.skill;
                                        s1.options.add(newOption);
                                   });   
                                   document.getElementById("y"+"<%=skill%>").selected = true;                             
                           }
                            
                           });  
                        }
                        });
};

</script>